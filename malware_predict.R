# Set working directory
setwd("example_dir/path/")

library(caret)
library(klaR)
library(randomForest)

# Read the dataset
malware        <- read.table('malware_data_32.csv',sep=",",header=TRUE)
# Convert the lables as factor
malware$labels <- as.factor(malware$labels)

# define an 80%/20% train/test split of the dataset
split      <- 0.80
trainIndex <- createDataPartition(malware$labels, p=split, list=FALSE)
data_train <- malware[ trainIndex,]
data_test  <- malware[-trainIndex,]
# train a random forest model
fit <- randomForest(labels ~ ., data=data_train,importance=TRUE,ntree=250, do.trace=TRUE,na.action=na.roughfix, nodesize=5, mtry=9)

# make predictions
x_test <- data_test[,2:1025]
y_test <- data_test[,1]
predictions <- predict(fit, x_test)

# summarize results as a confusion matrix 
# and save the confusion matrix as a table
results <- confusionMatrix(predictions, y_test)
write.table(results[[2]],file="predict.csv",sep=",")

